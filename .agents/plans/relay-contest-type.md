# Feature: –≠—Å—Ç–∞—Ñ–µ—Ç–∞ (Relay Contest Type)

## Feature Description

–ù–æ–≤—ã–π —Ç–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ **"–≠—Å—Ç–∞—Ñ–µ—Ç–∞"** ‚Äî –∫–æ–º–∞–Ω–¥–Ω—ã–π —Ç—É—Ä–Ω–∏—Ä:
- –ê–¥–º–∏–Ω –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –∫–æ–º–∞–Ω–¥–µ
- –ê–¥–º–∏–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∞—Ç—á–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ—á–∫–æ–≤
- –ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–º–µ–µ—Ç –∫–∞–ø–∏—Ç–∞–Ω–∞
- **–ö–∞–ø–∏—Ç–∞–Ω —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∞—Ç—á–∏** –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∫–æ–º–∞–Ω–¥—ã (–æ–¥–∏–Ω –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç –ò—Ç–∞–ª–∏—é, –¥—Ä—É–≥–æ–π –§—Ä–∞–Ω—Ü–∏—é –∏ —Ç.–¥.)
- –û—á–∫–∏ –∫–æ–º–∞–Ω–¥—ã —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –æ—Ç –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

## User Story

**–ö–∞–∫ –∞–¥–º–∏–Ω:**
- –•–æ—á—É —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥–Ω—ã–π –∫–æ–Ω–∫—É—Ä—Å —Å X —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –≤ –∫–æ–º–∞–Ω–¥–µ
- –•–æ—á—É –≤—ã–±—Ä–∞—Ç—å –º–∞—Ç—á–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –ª–∏–≥ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
- –•–æ—á—É –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ—á–∫–æ–≤

**–ö–∞–∫ –∫–∞–ø–∏—Ç–∞–Ω –∫–æ–º–∞–Ω–¥—ã:**
- –•–æ—á—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–∞—Ç—á–∏ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –º–æ–µ–π –∫–æ–º–∞–Ω–¥—ã
- –•–æ—á—É –≤–∏–¥–µ—Ç—å –∫—Ç–æ –∫–∞–∫–∏–µ –º–∞—Ç—á–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç
- –•–æ—á—É –≤–∏–¥–µ—Ç—å —Å—É–º–º–∞—Ä–Ω—ã–µ –æ—á–∫–∏ –∫–æ–º–∞–Ω–¥—ã

**–ö–∞–∫ —É—á–∞—Å—Ç–Ω–∏–∫ –∫–æ–º–∞–Ω–¥—ã:**
- –•–æ—á—É –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –º–Ω–µ –º–∞—Ç—á–∏
- –•–æ—á—É –¥–µ–ª–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã –Ω–∞ —Å–≤–æ–∏ –º–∞—Ç—á–∏
- –•–æ—á—É –≤–∏–¥–µ—Ç—å –≤–∫–ª–∞–¥ –≤ –æ–±—â–∏–µ –æ—á–∫–∏ –∫–æ–º–∞–Ω–¥—ã

## Problem Statement

–°–µ–π—á–∞—Å –≤—Å–µ –∫–æ–Ω–∫—É—Ä—Å—ã –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ. –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏.

## Solution Statement

1. –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø –∫–æ–Ω–∫—É—Ä—Å–∞ `relay` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–æ–º–∞–Ω–¥—ã
2. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `relay_event_assignments` –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∞—Ç—á–µ–π
3. –î–æ–±–∞–≤–∏—Ç—å API –¥–ª—è –∫–∞–ø–∏—Ç–∞–Ω–∞ (–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–∞—Ç—á–µ–π)
4. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ç–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–º–∏ –º–∞—Ç—á–∞–º–∏
5. –°—É–º–º–∏—Ä–æ–≤–∞—Ç—å –æ—á–∫–∏ –∫–æ–º–∞–Ω–¥—ã –æ—Ç –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

## Feature Metadata

**Feature Type**: New Capability  
**Estimated Complexity**: High  
**Primary Systems Affected**: contest-service, prediction-service, frontend, telegram-bot  
**Dependencies**: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ Team, TeamMember, TeamContestEntry

---

## CONTEXT REFERENCES

### Relevant Codebase Files

- `backend/shared/scoring/rules.go` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å ContestTypeRelay –∏ RelayRules
- `backend/contest-service/internal/models/team.go` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Team —Å –∫–∞–ø–∏—Ç–∞–Ω–æ–º
- `backend/contest-service/internal/models/team_member.go` ‚Äî TeamMember (role: captain/member)
- `backend/contest-service/internal/models/team_contest_entry.go` ‚Äî TeamContestEntry —Å TotalPoints
- `backend/prediction-service/internal/repository/event_repository.go` ‚Äî contest_events
- `backend/prediction-service/internal/service/prediction_service.go` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
- `frontend/src/components/contests/ScoringRulesEditor.tsx` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å relay —Ç–∏–ø
- `frontend/src/components/contests/EventSelector.tsx` ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–∞—Ç—á–µ–π

### New Files to Create

**Backend:**
- `backend/prediction-service/internal/models/relay_assignment.go` ‚Äî –º–æ–¥–µ–ª—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∞—Ç—á–µ–π
- `backend/prediction-service/internal/repository/relay_repository.go` ‚Äî CRUD –¥–ª—è assignments

**Frontend:**
- `frontend/src/components/relay/RelayAssignmentEditor.tsx` ‚Äî UI –¥–ª—è –∫–∞–ø–∏—Ç–∞–Ω–∞
- `frontend/src/components/relay/TeamEventsList.tsx` ‚Äî —Å–ø–∏—Å–æ–∫ –º–∞—Ç—á–µ–π –∫–æ–º–∞–Ω–¥—ã
- `frontend/src/pages/RelayManagement.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Å—Ç–∞—Ñ–µ—Ç–æ–π

### Database Schema

```sql
-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ç—á–µ–π –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∫–æ–º–∞–Ω–¥—ã
CREATE TABLE relay_event_assignments (
    id SERIAL PRIMARY KEY,
    contest_id BIGINT NOT NULL REFERENCES contests(id),
    team_id BIGINT NOT NULL REFERENCES user_teams(id),
    user_id BIGINT NOT NULL REFERENCES users(id),
    event_id BIGINT NOT NULL REFERENCES events(id),
    assigned_by BIGINT NOT NULL REFERENCES users(id),  -- –∫–∞–ø–∏—Ç–∞–Ω
    assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(contest_id, team_id, event_id),  -- –æ–¥–∏–Ω –º–∞—Ç—á = –æ–¥–∏–Ω —É—á–∞—Å—Ç–Ω–∏–∫ –≤ –∫–æ–º–∞–Ω–¥–µ
    FOREIGN KEY (team_id, user_id) REFERENCES user_team_members(team_id, user_id)
);

CREATE INDEX idx_relay_assignments_contest ON relay_event_assignments(contest_id);
CREATE INDEX idx_relay_assignments_team ON relay_event_assignments(team_id);
CREATE INDEX idx_relay_assignments_user ON relay_event_assignments(user_id);
```

### Patterns to Follow

**RelayRules —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```go
type RelayRules struct {
    TeamSize    int                  `json:"team_size"`    // —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –∫–æ–º–∞–Ω–¥–µ
    EventCount  int                  `json:"event_count"`  // –º–∞—Ç—á–µ–π –≤ –∫–æ–Ω–∫—É—Ä—Å–µ
    Scoring     StandardScoringRules `json:"scoring"`      // –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–¥—Å—á—ë—Ç–∞
    AllowReassign bool               `json:"allow_reassign"` // –º–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞—Ç—å
}
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –ø—Ä–æ–≥–Ω–æ–∑–µ:**
```go
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–∞—Ç—á –Ω–∞–∑–Ω–∞—á–µ–Ω —ç—Ç–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É –≤ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ
func (s *PredictionService) validateRelayAssignment(contestID, teamID, userID, eventID uint) error {
    // SELECT 1 FROM relay_event_assignments WHERE ...
}
```

---

## IMPLEMENTATION PLAN

### Phase 1: Backend ‚Äî Rules & Models

**–ó–∞–¥–∞—á–∏:**
- –î–æ–±–∞–≤–∏—Ç—å `ContestTypeRelay` –≤ rules.go
- –°–æ–∑–¥–∞—Ç—å `RelayRules` —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `RelayEventAssignment`
- –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è assignments
- –î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î

### Phase 2: Backend ‚Äî API

**–ó–∞–¥–∞—á–∏:**
- –î–æ–±–∞–≤–∏—Ç—å proto –º–µ—Ç–æ–¥—ã –¥–ª—è relay assignments
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å SetRelayAssignments (–∫–∞–ø–∏—Ç–∞–Ω)
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å GetTeamAssignments
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å GetUserAssignments (–¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–∞)
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ SubmitPrediction

### Phase 3: Backend ‚Äî Scoring

**–ó–∞–¥–∞—á–∏:**
- –î–æ–±–∞–≤–∏—Ç—å CalculateRelay –≤ calculator
- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—á–∫–∏ –∫–æ–º–∞–Ω–¥—ã –≤ TeamContestEntry
- –û–±–Ω–æ–≤–ª—è—Ç—å —Ä–∞–Ω–≥ –∫–æ–º–∞–Ω–¥—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞

### Phase 4: Frontend ‚Äî Admin

**–ó–∞–¥–∞—á–∏:**
- –î–æ–±–∞–≤–∏—Ç—å "–≠—Å—Ç–∞—Ñ–µ—Ç–∞" –≤ ScoringRulesEditor
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ team_size –∏ event_count
- –í—ã–±–æ—Ä –º–∞—Ç—á–µ–π (EventSelector)

### Phase 5: Frontend ‚Äî Captain

**–ó–∞–¥–∞—á–∏:**
- –°–æ–∑–¥–∞—Ç—å RelayAssignmentEditor
- UI —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∞—Ç—á–µ–π (drag & drop –∏–ª–∏ select)
- –ü–æ–∫–∞–∑–∞—Ç—å –∫—Ç–æ –∫–∞–∫–∏–µ –º–∞—Ç—á–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç
- –í–∞–ª–∏–¥–∞—Ü–∏—è (–≤—Å–µ –º–∞—Ç—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã)

### Phase 6: Frontend ‚Äî Member

**–ó–∞–¥–∞—á–∏:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –º–∞—Ç—á–∏
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–∫–ª–∞–¥ –≤ –æ—á–∫–∏ –∫–æ–º–∞–Ω–¥—ã
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –∫–æ–º–∞–Ω–¥

### Phase 7: Telegram Bot

**–ó–∞–¥–∞—á–∏:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥–Ω—ã–µ –∫–æ–Ω–∫—É—Ä—Å—ã
- –ö–∞–ø–∏—Ç–∞–Ω: –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∞—Ç—á–µ–π
- –£—á–∞—Å—Ç–Ω–∏–∫: —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –º–∞—Ç—á–∏
- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –∫–æ–º–∞–Ω–¥

---

## STEP-BY-STEP TASKS

### Task 1: UPDATE backend/shared/scoring/rules.go ‚Äî Add Relay Type

- **IMPLEMENT**: –î–æ–±–∞–≤–∏—Ç—å `ContestTypeRelay ContestType = "relay"`
- **IMPLEMENT**: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
  ```go
  type RelayRules struct {
      TeamSize      int                  `json:"team_size"`       // 2-10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
      EventCount    int                  `json:"event_count"`     // 5-50 –º–∞—Ç—á–µ–π
      Scoring       StandardScoringRules `json:"scoring"`
      AllowReassign bool                 `json:"allow_reassign"`  // –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ —Å—Ç–∞—Ä—Ç–∞
  }
  ```
- **IMPLEMENT**: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `Relay *RelayRules` –≤ ContestRules
- **IMPLEMENT**: –û–±–Ω–æ–≤–∏—Ç—å ParseRules, Validate, DefaultRelayRules
- **VALIDATE**: `cd backend/shared/scoring && go build .`

### Task 2: CREATE migration ‚Äî relay_event_assignments table

- **IMPLEMENT**: –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ `backend/shared/migrations/`
- **PATTERN**: –°–ª–µ–¥–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—É –∏–∑ existing migrations
- **VALIDATE**: `docker exec sports-postgres psql -U sports_user -d sports_prediction -c "\d relay_event_assignments"`

### Task 3: CREATE backend/prediction-service/internal/models/relay_assignment.go

- **IMPLEMENT**: –ú–æ–¥–µ–ª—å RelayEventAssignment
  ```go
  type RelayEventAssignment struct {
      ID         uint      `gorm:"primaryKey"`
      ContestID  uint      `gorm:"not null;index"`
      TeamID     uint      `gorm:"not null;index"`
      UserID     uint      `gorm:"not null;index"`
      EventID    uint      `gorm:"not null"`
      AssignedBy uint      `gorm:"not null"`
      AssignedAt time.Time `gorm:"default:CURRENT_TIMESTAMP"`
      gorm.Model
  }
  ```
- **VALIDATE**: `go build ./...`

### Task 4: CREATE backend/prediction-service/internal/repository/relay_repository.go

- **IMPLEMENT**: RelayRepository —Å –º–µ—Ç–æ–¥–∞–º–∏:
  - SetTeamAssignments(contestID, teamID, assignments []Assignment) error
  - GetTeamAssignments(contestID, teamID) ([]RelayEventAssignment, error)
  - GetUserAssignments(contestID, userID) ([]RelayEventAssignment, error)
  - ValidateUserCanPredict(contestID, teamID, userID, eventID) (bool, error)
- **PATTERN**: –°–ª–µ–¥–æ–≤–∞—Ç—å event_repository.go
- **VALIDATE**: `go build ./...`

### Task 5: UPDATE backend/proto/prediction.proto ‚Äî Relay API

- **IMPLEMENT**: –î–æ–±–∞–≤–∏—Ç—å RPC –º–µ—Ç–æ–¥—ã:
  ```protobuf
  rpc SetRelayAssignments(SetRelayAssignmentsRequest) returns (SetRelayAssignmentsResponse);
  rpc GetTeamAssignments(GetTeamAssignmentsRequest) returns (GetTeamAssignmentsResponse);
  rpc GetUserRelayEvents(GetUserRelayEventsRequest) returns (GetUserRelayEventsResponse);
  ```
- **IMPLEMENT**: –î–æ–±–∞–≤–∏—Ç—å message —Ç–∏–ø—ã
- **VALIDATE**: `./scripts/generate-protos.sh`

### Task 6: UPDATE prediction_service.go ‚Äî Implement Relay Methods

- **IMPLEMENT**: SetRelayAssignments ‚Äî —Ç–æ–ª—å–∫–æ –∫–∞–ø–∏—Ç–∞–Ω –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å
- **IMPLEMENT**: GetTeamAssignments ‚Äî —Å–ø–∏—Å–æ–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- **IMPLEMENT**: GetUserRelayEvents ‚Äî –º–∞—Ç—á–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- **VALIDATE**: `go build ./...`

### Task 7: UPDATE prediction_service.go ‚Äî Validate Relay Predictions

- **IMPLEMENT**: –í SubmitPrediction –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
  - –ï—Å–ª–∏ contest type = relay
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ user –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–æ–º–∞–Ω–¥–µ –≤ —ç—Ç–æ–º contest
  - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ event –Ω–∞–∑–Ω–∞—á–µ–Ω —ç—Ç–æ–º—É user
- **GOTCHA**: –ù–µ —Å–ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É –¥–ª—è standard/risky/totalizator
- **VALIDATE**: Manual testing

### Task 8: UPDATE scoring/calculator.go ‚Äî Team Score Aggregation

- **IMPLEMENT**: CalculateRelay (—Ç–æ –∂–µ —á—Ç–æ standard)
- **IMPLEMENT**: –§—É–Ω–∫—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –æ—á–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã:
  ```go
  func AggregateTeamScore(predictions []Prediction) float64
  ```
- **VALIDATE**: Unit tests

### Task 9: UPDATE frontend ScoringRulesEditor.tsx ‚Äî Add Relay

- **IMPLEMENT**: –î–æ–±–∞–≤–∏—Ç—å "üèÉ –≠—Å—Ç–∞—Ñ–µ—Ç–∞" –≤ Radio.Group
- **IMPLEMENT**: –ü—Ä–∏ –≤—ã–±–æ—Ä–µ relay –ø–æ–∫–∞–∑–∞—Ç—å:
  - team_size (2-10, default 5)
  - event_count (5-50, default 15)
  - StandardScoringRules –ø–æ–ª—è
- **VALIDATE**: `npm run build`

### Task 10: CREATE frontend RelayAssignmentEditor.tsx

- **IMPLEMENT**: UI –¥–ª—è –∫–∞–ø–∏—Ç–∞–Ω–∞:
  - –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã (—Å–ª–µ–≤–∞)
  - –°–ø–∏—Å–æ–∫ –º–∞—Ç—á–µ–π (—Å–ø—Ä–∞–≤–∞)
  - Drag & drop –∏–ª–∏ multi-select –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
  - –í–∞–ª–∏–¥–∞—Ü–∏—è: –≤—Å–µ –º–∞—Ç—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
  - –ö–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ"
- **PATTERN**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ant Design Transfer –∏–ª–∏ custom drag-drop
- **VALIDATE**: `npm run build`

### Task 11: UPDATE bots/telegram ‚Äî Relay Support

- **IMPLEMENT**: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–∏–ø "üèÉ –≠—Å—Ç–∞—Ñ–µ—Ç–∞"
- **IMPLEMENT**: –î–ª—è –∫–∞–ø–∏—Ç–∞–Ω–∞: –∫–æ–º–∞–Ω–¥–∞ `/assign` –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- **IMPLEMENT**: –î–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–∞: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –º–∞—Ç—á–∏
- **IMPLEMENT**: –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –∫–æ–º–∞–Ω–¥
- **VALIDATE**: Manual testing

---

## TESTING STRATEGY

### Unit Tests

- `rules_test.go`: TestParseRelayRules, TestValidateRelayRules
- `calculator_test.go`: TestCalculateRelay, TestAggregateTeamScore
- `relay_repository_test.go`: TestSetTeamAssignments, TestValidateUserCanPredict

### Integration Tests

- –°–æ–∑–¥–∞–Ω–∏–µ relay –∫–æ–Ω–∫—É—Ä—Å–∞
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã
- –ö–∞–ø–∏—Ç–∞–Ω —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–∞—Ç—á–∏
- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–µ–ª–∞—é—Ç –ø—Ä–æ–≥–Ω–æ–∑—ã
- –û—á–∫–∏ –∫–æ–º–∞–Ω–¥—ã —Å—É–º–º–∏—Ä—É—é—Ç—Å—è

### Edge Cases

- [ ] –ö–æ–º–∞–Ω–¥–∞ –Ω–µ –ø–æ–ª–Ω–∞—è (–º–µ–Ω—å—à–µ team_size)
- [ ] –ù–µ –≤—Å–µ –º–∞—Ç—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [ ] –£—á–∞—Å—Ç–Ω–∏–∫ –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–æ–π –º–∞—Ç—á
- [ ] –ö–∞–ø–∏—Ç–∞–Ω –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ—Ç –º–∞—Ç—á –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ (–µ—Å–ª–∏ allow_reassign=false)
- [ ] –£—á–∞—Å—Ç–Ω–∏–∫ –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –∫–æ–º–∞–Ω–¥—ã

---

## VALIDATION COMMANDS

### Level 1: Build

```bash
cd backend/shared/scoring && go build .
cd backend && go build ./prediction-service/...
cd frontend && npm run build
cd bots/telegram && go build ./...
```

### Level 2: Tests

```bash
cd backend && go test ./shared/scoring/... -v
cd backend && go test ./prediction-service/... -v
```

### Level 3: Integration

```bash
docker-compose up -d
# Test via API / Telegram bot
```

---

## ACCEPTANCE CRITERIA

- [ ] –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω–∫—É—Ä—Å —Ç–∏–ø–∞ "–≠—Å—Ç–∞—Ñ–µ—Ç–∞" —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–æ–º–∞–Ω–¥—ã
- [ ] –ö–æ–º–∞–Ω–¥—ã –º–æ–≥—É—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∫–æ–Ω–∫—É—Ä—Å–µ
- [ ] –ö–∞–ø–∏—Ç–∞–Ω –º–æ–∂–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –º–∞—Ç—á–∏ –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- [ ] –£—á–∞—Å—Ç–Ω–∏–∫–∏ –≤–∏–¥—è—Ç –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É—é—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –º–∞—Ç—á–∏
- [ ] –û—á–∫–∏ –∫–æ–º–∞–Ω–¥—ã —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –æ—Ç –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- [ ] –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã, –Ω–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª–æ–≤
- [ ] Telegram –±–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç relay –∫–æ–Ω–∫—É—Ä—Å—ã

---

## NOTES

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

**–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ç—á–µ–π:**
- –ö–∞–ø–∏—Ç–∞–Ω –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –∫–∞–∂–¥—ã–π –º–∞—Ç—á –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É
- –û–¥–∏–Ω –º–∞—Ç—á = –æ–¥–∏–Ω —É—á–∞—Å—Ç–Ω–∏–∫ (–≤ —Ä–∞–º–∫–∞—Ö –∫–æ–º–∞–Ω–¥—ã)
- –í—Å–µ –º–∞—Ç—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞

**–°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—á–∫–æ–≤:**
- –ö–∞–∂–¥—ã–π –ø—Ä–æ–≥–Ω–æ–∑ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ (–∫–∞–∫ –≤ standard)
- TeamContestEntry.TotalPoints = SUM(–≤—Å–µ—Ö –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã)
- –†–∞–Ω–≥ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ TotalPoints –∫–æ–º–∞–Ω–¥—ã

### –û—Ç–ª–∏—á–∏–µ –æ—Ç –¢–æ—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä–∞

| –ê—Å–ø–µ–∫—Ç | –¢–æ—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä | –≠—Å—Ç–∞—Ñ–µ—Ç–∞ |
|--------|-------------|----------|
| –£—á–∞—Å—Ç–∏–µ | –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ | –ö–æ–º–∞–Ω–¥–Ω–æ–µ |
| –ú–∞—Ç—á–∏ | –í—Å–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç –æ–¥–∏–Ω | –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ |
| –û—á–∫–∏ | –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ | –°—É–º–º–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–º–∞–Ω–¥–Ω—ã–µ |
| –õ–∏–¥–µ—Ä–±–æ—Ä–¥ | –ü–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º | –ü–æ –∫–æ–º–∞–Ω–¥–∞–º |

### –°–ª–æ–∂–Ω–æ—Å—Ç—å

–≠—Ç–∞ —Ñ–∏—á–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–µ–µ –¢–æ—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –∏–∑-–∑–∞:
1. –ö–æ–º–∞–Ω–¥–Ω–æ–π –ª–æ–≥–∏–∫–∏
2. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∞—Ç—á–µ–π
3. –í–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∞–≤ –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑
4. –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ –æ—á–∫–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–∞–∑–±–∏—Ç—å –Ω–∞ 2-3 PR:**
1. Backend: rules + models + repository
2. Backend: API + validation
3. Frontend + Telegram bot

---

## CONFIDENCE SCORE

**7/10** ‚Äî –í—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –º–Ω–æ–≥–æ —Ç–æ—á–µ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç—â–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥–Ω–æ–π –ª–æ–≥–∏–∫–∏.
